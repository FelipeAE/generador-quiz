# CLAUDE.md

This file provides comprehensive guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- **Start development server**: `npm run dev`
- **Build for production**: `npm run build`
- **Lint code**: `npm run lint`
- **Preview production build**: `npm run preview`

## Project Overview

**Generador de Quiz Personalizado** is a React + TypeScript + Vite application that enables users to create and take personalized quizzes. The app processes JSON-formatted quiz data generated by AI assistants and provides an interactive quiz-taking interface.

### Core Philosophy

This app follows a **"separation of concerns"** philosophy:
- **Frontend**: Handles JSON input, quiz UI, and results display
- **AI Integration**: External (user brings JSON from their preferred AI)
- **Document Processing**: Client-side text extraction for AI preparation

## Project Architecture

### Component Structure

#### Main Components

**[App.tsx](src/App.tsx)**
- Entry point that renders the QuizGenerator component
- Minimal wrapper with no additional logic

**[QuizGenerator.tsx](src/components/QuizGenerator.tsx)** (Main Hub)
Core component containing all quiz logic:
- JSON input parsing and validation
- Quiz state management (questions, current index, user answers)
- Quiz navigation and completion
- Results display and download functionality
- Random question ordering option
- URL sharing functionality (hash-based and TinyURL integration)
- Text extraction coordination

**[FileUploader.tsx](src/components/FileUploader.tsx)**
Document processing component:
- **Current support**: Word documents (.docx) via mammoth.js
- **Experimental support**: RTF files (basic parsing)
- **Known limitation**: PDF support disabled (see "Lessons Learned" section)
- Drag-and-drop and click-to-upload interfaces
- Client-side processing (no server upload)
- File size validation (15MB limit)
- Multiple file handling (processes first file only)

**[TextExtractor.tsx](src/components/TextExtractor.tsx)**
Display and management of extracted text:
- Shows extracted text in textarea
- Word count and character count statistics
- Copy to clipboard functionality
- Clear text functionality
- Step-by-step instructions for AI workflow

### Data Types ([src/types/quiz.ts](src/types/quiz.ts))

```typescript
export type QuizQuestion = {
  question: string;
  choices: string[];
  answer: number;
};

export type QuizData = {
  questions: QuizQuestion[];
};

export type QuizResult = {
  score: number;
  total: number;
  percentage: number;
  answers: (number | null)[];
};
```

### Dependencies

**Production:**
- `react` & `react-dom`: UI framework
- `mammoth`: Word document (.docx) text extraction
- `pdfjs-dist`: PDF processing (currently disabled in UI)
- `pdf-lib`: PDF manipulation (for future features)
- `docx`: Word document creation (for future features)

**Development:**
- `vite`: Build tool and dev server
- `typescript`: Type safety
- `eslint`: Code linting

## JSON Data Format

The app validates and supports two types of questions:

### Multiple Choice (4 options)
```json
{
  "question": "¬øCu√°l es la capital de Francia?",
  "choices": ["Par√≠s", "Madrid", "Berl√≠n", "Roma"],
  "answer": 0
}
```

### True/False (2 options)
```json
{
  "question": "La Tierra es el tercer planeta del sistema solar",
  "choices": ["Verdadero", "Falso"],
  "answer": 0
}
```

### Validation Rules

- Questions must be in an array format
- Each question requires **exactly 2 choices** (true/false) OR **exactly 4 choices** (multiple choice)
- `answer` field must be a number (0-indexed) pointing to the correct choice
- True/false questions get special CSS styling (green/red color coding)
- Questions are validated before quiz generation in [QuizGenerator.tsx:261-289](src/components/QuizGenerator.tsx#L261-L289)

## Application Workflow

### User Journey

```
1. Input Phase
   ‚îú‚îÄ Option A: Upload Word document ‚Üí Extract text ‚Üí Copy to AI
   ‚îú‚îÄ Option B: Manually paste JSON from AI
   ‚îî‚îÄ Option C: Load from shared URL (hash or TinyURL)

2. Generation Phase
   ‚îú‚îÄ JSON parsing and validation
   ‚îú‚îÄ Optional: Randomize question order
   ‚îî‚îÄ Initialize quiz state

3. Quiz Phase
   ‚îú‚îÄ Navigate through questions
   ‚îú‚îÄ Select answers
   ‚îú‚îÄ Track progress
   ‚îî‚îÄ Share quiz via URL or JSON

4. Results Phase
   ‚îú‚îÄ Calculate score
   ‚îú‚îÄ Display detailed results
   ‚îú‚îÄ Share results text
   ‚îî‚îÄ Option to start new quiz
```

## Key Features

### ‚úÖ Working Features

- **JSON-based quiz input** with comprehensive validation
- **Random question ordering** option
- **Progress tracking** with visual progress bar
- **Quiz navigation** (previous/next, question jumping)
- **Comprehensive results** with correct/incorrect answer review
- **Multiple sharing options**:
  - Hash-based URLs (client-side, no server)
  - TinyURL integration for shorter links
  - JSON copy to clipboard
  - Results copy to clipboard
- **Word document text extraction** (.docx files)
- **Drag-and-drop file upload**
- **Client-side processing** (privacy-focused, no server uploads)

### üöß Known Limitations

See "Lessons Learned" section below for technical details.

## Lessons Learned: Document Processing Challenges

This section documents the technical challenges encountered when implementing multi-file PDF/Word processing, to guide future development iterations.

### ‚ùå PDF Processing Issues

**Problem**: PDF text extraction via pdfjs-dist was unreliable in production

**Technical Details**:
- `pdfjs-dist` requires Web Workers to function
- Worker configuration issues in different environments (dev vs production, different CDNs)
- Inconsistent results across different PDF formats
- Some PDFs failed silently, others threw errors
- Worker paths: `jsDelivr` vs `cdnjs` vs local bundling

**Attempted Solutions**:
1. Tried multiple CDN configurations for worker
2. Attempted local bundling of worker file
3. Tried different versions of pdfjs-dist
4. None provided consistent reliability

**Current Status**: PDF upload disabled in UI
- Code remains in [FileUploader.tsx:30-50](src/components/FileUploader.tsx#L30-L50) (commented out)
- User receives friendly error message directing them to convert PDF to Word first
- See [FileUploader.tsx:96-99](src/components/FileUploader.tsx#L96-L99)

**Recommended Approach Going Forward**:
- Keep PDFs disabled until a more reliable library is found
- Alternative: Recommend external conversion (PDF ‚Üí Word) before upload
- Consider server-side PDF processing if backend is added in future
- **Do NOT** attempt to re-enable PDF support without extensive testing across multiple environments

### ‚ö†Ô∏è Multi-File Processing Complexity

**Problem**: Attempted to implement multiple file processing but removed due to UX complexity

**Technical Details**:
- Code was written to handle `FileList` and extract text from multiple documents
- State management became complex: `extractedFiles[]` array
- UI/UX questions arose:
  - Should files be concatenated into one quiz?
  - Should each file generate a separate quiz?
  - How should users manage multiple extracted texts?
  - What's the best way to display multiple file previews?

**Attempted Solutions**:
1. Array of extracted file objects with individual copy buttons
2. "Copy all" function to concatenate texts
3. Individual file removal functionality
4. None felt intuitive enough for end users

**Current Status**: Single file processing only
- Code structure supports multiple files internally
- UI only processes and displays first file
- Unused multi-file code commented out throughout codebase
- See [FileUploader.tsx:142-147](src/components/FileUploader.tsx#L142-L147)

**Recommended Approach Going Forward**:
- **Phase 1**: Keep single-file processing (current state)
- **Phase 2** (if needed): Add clear UX design first:
  - Decide: Concatenate vs separate quizzes?
  - Design clear visual hierarchy for multiple files
  - Add proper file management (remove, reorder, preview)
  - Consider adding tabs or accordion UI for multiple extractions
- **Do NOT** re-enable multi-file without solving UX design questions first
- Consider user research: Do users actually need multi-file? When?

### ‚úÖ What Works Well

**Word Document Processing**:
- Mammoth.js is reliable and fast
- .docx format is well-supported
- RTF files work with basic parsing (good enough for most cases)
- Client-side processing maintains user privacy
- 15MB file size limit is reasonable for most documents

**Current Workflow**:
1. User uploads .docx file
2. Text extracted instantly (client-side)
3. Text displayed in textarea with statistics
4. User copies text + prompt to AI (ChatGPT, Claude, Gemini, etc.)
5. AI generates JSON quiz
6. User pastes JSON back into app
7. Quiz generated successfully

**This workflow is simple, reliable, and requires no backend infrastructure.**

## URL Sharing System

### Architecture

**Two sharing methods implemented**:

1. **Hash-based URLs** (QuizGenerator.tsx:36-241)
   - Compression: JSON ‚Üí LZ string compression ‚Üí Base64 ‚Üí URL-safe format
   - Stored in URL hash: `#quiz=<compressed_data>`
   - Client-side only, no server required
   - Limitation: URLs can be very long (2000+ characters)
   - Fallback: Works for all quiz sizes

2. **TinyURL Integration** (QuizGenerator.tsx:84-105, 428-539)
   - For URLs >500 characters, attempts to shorten via TinyURL API
   - Free public API: `https://tinyurl.com/api-create.php?url=<long_url>`
   - No API key required
   - Graceful fallback to long URL if service unavailable
   - User-friendly status messages throughout process

### URL Loading

Auto-detection on page load ([QuizGenerator.tsx:108-121](src/components/QuizGenerator.tsx#L108-L121)):
- Checks for `?gist=<id>` (GitHub Gist - legacy support)
- Checks for `?bin=<id>` (JSONBin.io - legacy support)
- Checks for `#quiz=<data>` (current hash-based method)
- Decompresses and validates data
- Auto-generates quiz if valid
- Clears URL after loading (security/privacy)

## Styling

### CSS Architecture

**[index.css](src/index.css)**
- Global styles and CSS reset
- Typography and color variables
- Responsive breakpoints

**[App.css](src/App.css)**
- Component-specific styles
- Quiz interface styling
- Animations and transitions
- Gradient backgrounds
- Button styles
- Form elements
- Results display
- File uploader styling
- Text extractor styling

### Design System

- Modern gradient backgrounds
- Responsive grid layouts
- Interactive hover states
- Smooth transitions
- Mobile-first approach
- Accessible color contrasts
- Clear visual hierarchy

## Integration with AI Services

### Supported AI Platforms

The app is designed to work with **any AI that can generate JSON**:
- ChatGPT (OpenAI)
- Claude (Anthropic)
- Gemini (Google)
- Any other LLM with JSON output capability

### AI Prompt Template

Located in [QuizGenerator.tsx:721-738](src/components/QuizGenerator.tsx#L721-L738), the app provides users with a comprehensive prompt template:

**Key Prompt Features**:
- Clear JSON structure specification
- Support for both multiple-choice and true/false questions
- Customizable question count (minimum 20)
- Language flexibility
- Strict formatting rules to ensure valid JSON output
- No additional text or explanations requested

**User Workflow**:
1. Extract text from document (or have content ready)
2. Copy the provided prompt
3. Paste text + prompt into AI chat
4. Copy JSON output
5. Paste JSON into quiz generator
6. Generate quiz

This **manual integration** approach was chosen over automatic AI API calls because:
- No API keys needed (user privacy and simplicity)
- Users can choose their preferred AI
- No rate limiting or costs
- Users see exactly what's being sent to the AI
- More transparent and trustworthy

## Code Quality Notes

### Type Safety

- Full TypeScript coverage
- Strict type checking enabled
- All props properly typed
- Minimal use of `any` types

### Error Handling

- JSON validation with user-friendly error messages
- File upload validation (size, type)
- Network request error handling (URL sharing)
- Graceful fallbacks throughout

### State Management

- React `useState` for local component state
- Props drilling for component communication
- No external state management library (keeps bundle small)

### Performance Considerations

- Client-side text extraction (no server latency)
- Lazy loading not needed (single-page app)
- Minimal re-renders (proper state updates)
- No unnecessary dependencies

## Deployment

### Build Configuration

- Vite production build: `npm run build`
- Output directory: `dist/`
- Optimized and minified bundles
- Source maps enabled for debugging

### GitHub Pages

- Configured in [package.json:6](package.json#L6): `"homepage": "https://fiae.github.io/generador-quiz"`
- Deploy via GitHub Actions or manual `gh-pages` branch
- Static site, no server-side logic needed

## Future Improvements (Recommendations)

### High Priority

1. **Improve PDF Support** (if feasible)
   - Research alternative PDF libraries
   - Consider server-side PDF processing
   - Extensive cross-browser testing required

2. **Export Quiz as PDF**
   - Allow users to print/save quiz as PDF
   - Use `pdf-lib` (already in dependencies)

3. **Quiz Templates**
   - Pre-built prompt templates for different subjects
   - Customizable question types

### Medium Priority

4. **Multi-file Processing UX** (only if user demand exists)
   - Design clear UX flow first
   - Decide on concatenation vs separate quizzes
   - Implement proper file management UI

5. **Quiz History**
   - LocalStorage to save previous quizzes
   - Quick access to recently used quizzes

6. **Advanced Quiz Settings**
   - Time limits per question
   - Different scoring methods
   - Question categories/tags

### Low Priority

7. **Offline Support**
   - Service worker for offline functionality
   - PWA capabilities

8. **Accessibility Improvements**
   - Screen reader optimization
   - Keyboard navigation enhancements
   - ARIA labels audit

## Development Guidelines for Claude

### When Making Changes

1. **Always read files before editing** - Use Read tool first
2. **Maintain existing code style** - Follow TypeScript/React conventions
3. **Test thoroughly** - Run `npm run dev` and manually test features
4. **Validate TypeScript** - Run `npm run build` to ensure no type errors
5. **Update this file** - Keep CLAUDE.md in sync with code changes

### Common Pitfalls to Avoid

‚ùå **Don't re-enable PDF support** without solving reliability issues first
‚ùå **Don't implement multi-file UI** without clear UX design
‚ùå **Don't add new dependencies** without strong justification
‚ùå **Don't modify the JSON validation** without updating documentation
‚ùå **Don't change URL compression** without backwards compatibility

### When Asked to Add Features

1. **Clarify requirements** - Ask questions if unclear
2. **Check existing code** - Feature might already exist (commented out)
3. **Consider UX impact** - How will users interact with this?
4. **Evaluate trade-offs** - Bundle size, complexity, maintenance
5. **Document decisions** - Update CLAUDE.md with reasoning

## Project Status

**Current Version**: Production-ready
**Stability**: Stable (with known limitations documented)
**Maintenance**: Active development
**Documentation**: Comprehensive

This app is fully functional for its core purpose: creating quizzes from AI-generated JSON. The document processing features are a convenience layer that work well for Word documents, with clear guidance for PDF conversion.

---

**Last Updated**: 2025-01-14
**Maintained By**: Development team using Claude Code